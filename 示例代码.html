<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
    <!-- é¦–é¡µçš„æ ·å¼ -->
    <link rel="stylesheet" href="./css/index.css" />
    <!-- æœç´¢çš„æ ·å¼ -->
    <link rel="stylesheet" href="./css/results.css" />
    <!-- æ’­æ”¾å™¨çš„æ ·å¼ -->
    <link rel="stylesheet" href="./css/player.css" />
    <!-- videoæ’­æ”¾å™¨çš„æ ·å¼ -->
    <link rel="stylesheet" href="./css/video.css" />
    <!-- è¯„è®ºçš„æ ·å¼ -->
    <link rel="stylesheet" href="./css/comment.css" />
    <link rel="stylesheet" href="./css/iconfont.css" />
  </head>
  <body>
    <div id="player">
      <h2 class="title">é»‘äº‘éŸ³ä¹</h2>
      <div class="search">
        <!-- æœç´¢æ¡† åŒå‘æ•°æ®ç»‘å®š æŒ‰ä¸‹å›è½¦ -->
        <input type="text" v-model.trim="search" @keyup.enter="searchMusic" />
        <button @click="searchMusic">
          <span class="iconfont icon-search"></span>
        </button>
      </div>
      <!-- tabï¼ˆè·¯ç”±ï¼‰ -->
      <div class="tab-wrapper">
        <!-- tab-nav -->
        <div class="tab-bar">
          <!-- <a class="bar-item active"> -->
          <router-link active-class="active" to="/result" class="bar-item">
            æœç´¢ç»“æœ
          </router-link>
          <!-- </a> -->
          <!-- <a class="bar-item"> -->
          <router-link active-class="active" to="/player" class="bar-item">
            æ­Œæ›²æ’­æ”¾
          </router-link>
          <!-- </a> -->
          <!-- <a class="bar-item"> -->
          <router-link active-class="active" to="/video" class="bar-item">
            mv
          </router-link>
          <!-- </a> -->
          <!-- <a class="bar-item"> -->
          <router-link active-class="active" to="/comment" class="bar-item">
            æ­Œæ›²è¯„è®º
          </router-link>
        </div>
        <!-- å¯¹åº”çš„å†…å®¹åŒºåŸŸ -->
        <div class="tab-content">
          <!-- å†…å®¹  -->
          <router-view></router-view>
        </div>
      </div>
    </div>
  </body>
</html>
<!-- ç»„ä»¶1 æœç´¢ç»“æœ -->
<script type="text/html" id="resultTem">
  <div class="result-wrapper">
    <div class="song" v-for="item in musicList">
      <div class="name">
        <span class="iconfont icon-play" @click="toPlay(item.id)"></span>
        <a href="javascript:void(0)" @click="toComment(item.id)">{{item.name}}</a>
        <span class="iconfont icon-editmedia" v-if="item.mvid!=0" @click="toMv(item.mvid)"></span>
      </div>
      <div class="singer">{{item.artists | formatSinger}}</div>
      <div class="album">ã€Š{{item.album.name}}ã€‹</div>
      <!-- æŒç»­æ—¶é—´ -->
      <div class="time">{{item.duration | formatTime}}</div>
    </div>
  </div>
</script>
<!-- ç»„ä»¶2 éŸ³ä¹æ’­æ”¾å™¨ -->
<script type="text/html" id="playerTem">
  <div class="player">
      <div class="left">
        <img class="disc" src="./img/disc.png" alt="">
        <img class="cover" :src="coverUrl" alt="">
      </div>
      <div class="right">
        <div class="title"><img src="./img/tag.png" alt=""><span>{{songName}}</span> </div>
        <div class="singer">æ­Œæ‰‹: <span>{{singerName}}</span></div>
        <div class="album">æ‰€å±ä¸“è¾‘: <span>{{albumName}}</span></div>
        <audio class="audio" controls="" autoplay :src="musicUrl"></audio>
        <ul class="lyric-container">
          <li class="lyric" v-for="item in lyric">{{item}}</li>
        </ul>
      </div>
    </div>
</script>
<!-- ç»„ä»¶3 mvæ’­æ”¾å™¨ -->
<script type="text/html" id="videoTem">
  <div class="video">
      <div class="title-wrapper">
        <span class="tag">MV</span>
        <span class="title">{{mvName}}</span>
        <span class="artist">{{mvArtist}}</span>
      </div>
      <video :src="mvUrl" autoplay controls=""></video>
  </div>
</script>
<!-- ç»„ä»¶4 æ­Œæ›²è¯„è®º -->
<script type="text/html" id="commentTem">
  <div class="comment-wrapper">
      <div class="items">
        <div class="item" v-for="item in commentList">
          <div class="left">
            <img :src="item.user.avatarUrl" alt="">
          </div>
          <div class="right">
            <div class="top">
              <span class="user">{{item.user.nickname}}:</span>
              <span class="content">{{item.content}}</span>
            </div>
            <div class="bottom">
              <div class="time">2016å¹´9æœˆ18æ—¥</div>
              <div class="like-wrapper">
                  <span>ğŸ‘</span>({{item.likedCount}})
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
</script>
<!-- å¯¼å…¥vue -->
<!-- <script src="https://unpkg.com/vue/dist/vue.js"></script> -->
<script src="./lib/vue.js"></script>
<!-- å¯¼å…¥è·¯ç”± -->
<!-- <script src="https://unpkg.com/vue-router/dist/vue-router.js"></script> -->
<script src="./lib/vue-router.js"></script>
<!-- å¯¼å…¥axios -->
<script src="./lib/axios.js"></script>
<script>
  // 0. å¦‚æœä½¿ç”¨æ¨¡å—åŒ–æœºåˆ¶ç¼–ç¨‹ï¼Œå¯¼å…¥Vueå’ŒVueRouterï¼Œè¦è°ƒç”¨ Vue.use(VueRouter)

  // 1. å®šä¹‰ (è·¯ç”±) ç»„ä»¶ã€‚
  // æœç´¢ç»“æœç»„ä»¶
  const result = {
    template: '#resultTem',
    // æ•°æ®
    data() {
      return {
        // æ­Œæ›²åˆ—è¡¨
        musicList: []
      }
    },
    // æ–¹æ³•
    methods: {
      toPlay(id) {
        // ä»£ç è·³è½¬
        router.push(`/player/${id}`)
      },
      // å»çœ‹mv
      toMv(mvid) {
        router.push(`/video/${mvid}`)
      },
      // å»çœ‹è¯„è®º
      toComment(id) {
        router.push(`/comment/${id}`)
      }
    },
    // è¿‡æ»¤å™¨
    filters: {
      // å¤„ç†æ ¼å¼
      formatSinger(singers) {
        // console.log(singers)
        // ç©ºå­—ç¬¦ä¸²æ‹¼æ¥
        let temStr = ''
        // è·å–æ‰€æœ‰çš„æ­Œæ‰‹
        for (let i = 0; i < singers.length; i++) {
          // æ‹¼æ¥æ­Œæ‰‹
          temStr += singers[i].name
          // æ‹¼æ¥åˆ†éš”ç¬¦
          temStr += '/'
        }
        // ç§»é™¤æœ€åä¸€ä¸ª/
        // 0ä»0å¼€å§‹
        // -1 åˆ°å€’æ•°ç¬¬äºŒä¸ª ï¼ˆ-1 ,ä»åå¾€å‰æ¥ç®—ï¼‰
        temStr = temStr.slice(0, -1)

        // return'ç‰›é€¼çš„æ­Œæ‰‹'
        // è¿”å›æ‹¼æ¥çš„æ•°æ®
        return temStr
      },
      // å¤„ç†æ—¶é—´
      formatTime(time) {
        console.log(time)
        // æ¯«ç§’->ç§’
        const totalSec = time / 1000
        // ç§’->åˆ† å°æ•°éƒ¨åˆ†èˆå»
        const min = Math.floor(totalSec / 60)
        // å‰©ä½™çš„éƒ¨åˆ†æ˜¯ ç§’ ä¸æ»¡è¶³åˆ†çš„éƒ¨åˆ† å…¨éƒ¨åˆ°ç§’
        let sec = Math.floor(totalSec % 60)
        // ç§’ä¸å¤Ÿ2ä½ è¡¥è¶³2ä½
        sec = sec < 10 ? '0' + sec : sec

        return min + ':' + sec
      }
    },
    // ç»„ä»¶åˆ›å»ºå®Œæ¯•
    created() {
      // è·å–æ•°æ®
      // console.log(this.$route.params.search)
      // axiosæ¥å£è°ƒç”¨
      axios
        .get(
          `https://autumnfish.cn/search?keywords=${this.$route.params.search}`
        )
        .then(backData => {
          // console.log(backData)
          // ä¿å­˜æ­Œæ›²åˆ—è¡¨
          this.musicList = backData.data.result.songs
        })
    }
  }
  // æ’­æ”¾å™¨ç»„ä»¶
  const player = {
    template: '#playerTem',
    // æ•°æ® æ˜¯æ–¹æ³•
    data() {
      return {
        // æ­Œæ›²åœ°å€
        musicUrl: '',
        // æ­Œæ‰‹å
        singerName: '',
        // å°é¢
        coverUrl: '',
        // ä¸“è¾‘å
        albumName: '',
        // æ­Œå
        songName: '',
        // æ­Œè¯
        lyric: []
      }
    },
    // ç”Ÿå‘½å‘¨æœŸé’©å­
    created() {
      // è·å–id
      // è°ƒç”¨æ¥å£ è·å–url
      axios
        .get(`https://autumnfish.cn/song/url?id=${this.$route.params.id}`)
        .then(backData => {
          // console.log(backData)
          // è®¾ç½®æ­Œæ›²åœ°å€
          this.musicUrl = backData.data.data[0].url
        })

      // è°ƒç”¨æ¥å£ è·å– æ­Œæ›²ä¿¡æ¯
      axios
        .get(`https://autumnfish.cn/song/detail?ids=${this.$route.params.id}`)
        .then(backData => {
          // console.log(backData)
          // å°é¢åœ°å€
          this.coverUrl = backData.data.songs[0].al.picUrl
          // ä¸“è¾‘å
          this.albumName = backData.data.songs[0].al.name
          // æ­Œæ‰‹å
          this.singerName = backData.data.songs[0].ar[0].name
          // æ­Œå
          this.songName = backData.data.songs[0].name
        })

      // æ­Œè¯
      axios
        .get(`https://autumnfish.cn/lyric?id=${this.$route.params.id}`)
        .then(backData => {
          // console.log(backData)
          // ä¿å­˜æ­Œè¯ä¸ºæ•°ç»„
          this.lyric = backData.data.lrc.lyric.split('\n')
          // å¾ªç¯æ•°ç»„ åˆ‡æ‰ [00:00.000]
          for (let i = 0; i < this.lyric.length; i++) {
            this.lyric[i] = this.lyric[i].slice(11)
          }
        })
    }
  }
  // mvç»„ä»¶
  const video = {
    template: '#videoTem',
    data() {
      return {
        mvName: '',
        mvUrl: '',
        mvArtist: ''
      }
    },
    created() {
      axios
        .get(`https://autumnfish.cn/mv/detail?mvid=${this.$route.params.mvid}`)
        .then(backData => {
          // console.log(backData)
          this.mvName = backData.data.data.name
          this.mvUrl = backData.data.data.brs['240']
          this.mvArtist = backData.data.artistName
        })
    }
  }
  // è¯„è®ºç»„ä»¶
  const comment = {
    template: '#commentTem',
    data() {
      return {
        commentList: []
      }
    },
    created() {
      axios.get(`https://autumnfish.cn/comment/hot?id=${this.$route.params.id}&type=0`)
      .then(backData=>{
        // console.log(backData);
        this.commentList = backData.data.hotComments;
      })
    }
  }

  // 2. å®šä¹‰è·¯ç”±
  const routes = [
    // ä¸ºäº†èƒ½å¤Ÿä¼ é€’æ•°æ® è§„åˆ™éœ€è¦å®šä¹‰ä¸º/result/:xx
    { path: '/result/:search', component: result },
    { path: '/player/:id', component: player },
    { path: '/video/:mvid', component: video },
    { path: '/comment/:id', component: comment }
  ]

  // 3. åˆ›å»º router å®ä¾‹ï¼Œç„¶åä¼  `routes` é…ç½®
  // ä½ è¿˜å¯ä»¥ä¼ åˆ«çš„é…ç½®å‚æ•°, ä¸è¿‡å…ˆè¿™ä¹ˆç®€å•ç€å§ã€‚
  const router = new VueRouter({
    routes // (ç¼©å†™) ç›¸å½“äº routes: routes
  })

  // 4. åˆ›å»ºå’ŒæŒ‚è½½æ ¹å®ä¾‹ã€‚
  const app = new Vue({
    el: '#player',
    // æŒ‚è½½è·¯ç”±
    router,
    // dataå°±æ˜¯å¯¹è±¡
    data: {
      // æœç´¢çš„å…³é”®å­—
      search: ''
    },
    // æ–¹æ³•
    methods: {
      // æœç´¢æ•°æ® æŠŠå€¼ ä¼ é€’ç»™result
      searchMusic() {
        // console.log('å»æœç´¢')
        // è·å–search
        // ä»£ç çš„æ–¹å¼åˆ‡æ¢ è·¯ç”±ï¼ˆç¼–ç¨‹å¼å¯¼èˆªï¼‰
        router.push(`/result/${this.search}`)
      }
    }
  })
</script>
